---
layout: post
title: "Work Log"
description: ""
category: 'Work Log'
tags: []
---
{% include JB/setup %}

Recall  the expression for the i-th element of the gradient of ML w.r.t. indices.

<div>
\[
\begin{align}
g'_i(x) &= \frac{1}{2} z(x)^\top K'(x) z(x) \\
        &= \frac{1}{2} z_i(x) \delta_i^\top(x) z(x) - Z'_i(x) \\
        &= f_i(x) - Z'_i(x)
\end{align}
\]
</div>

Where \\(\delta_i = k'(x_i, x_j)\\), and \\(Z'_i\\) is the derivitive of the normalization constant.

Next we'll derive the second derivitive starting with the first term, f_i(x).

First term, f_i'
------------------

First, we take the second derivitive of the kernel function, which has the conveniently simple form:

<div>
\[
\begin{align}
\frac{\partial^2 k(x_i, k_j)}{\partial x_i \partial x_j} &= \min(x_i, x_j) \\
\frac{\partial \delta_i(x)}{\partial x_j} &= (0, ..., \min(x_i, x_j), ..., 0)^\top
\end{align}
\]
</div>

The derivitive of f is then

<div>
\[
\begin{align}
\frac{\partial f_i(x)}{\partial x_j} &=
            \left ( \frac{\partial}{\partial x_j} \, z_i(x) \right ) \delta_i^\top(x) z(x)  +
            z_i(x) \left ( \frac{\partial}{\partial x_j}\delta_i^\top(x) \right ) z(x) +
            z_i(x) \, \delta_i^\top(x) \left ( \frac{\partial}{\partial x_j} z(x) \right ) \\
&=
            z_i' (x) \, \delta_i^\top(x) \, z(x)  +
            z_i(x) \, \min(x_i, x_j) \, z_j(x) + 
            z_i(x) \, \delta_i^\top(x) \, z'(x)
\end{align}
\]

where 

\[
\begin{align}
\frac{\partial z(x)}{\partial x_j} &= \frac{\partial}{\partial x_j} S^\top U^{-1}(x) S y \\
        &= S V' S^\top y \\
        &= S^\top U^{-1} U' U^{-1} S y \\
        &= (S^\top U^{-1} S) K' (S^\top U^{-1} S) y
\end{align}
\]
</div>

All the vectors \\(f_i\\) make up the columns of the hessian matrix.

We'll now show that the running time is cubic.  Each of the \\(z_i\\)'s are are each pre-computed in quadratic time, so all precomputation is accomplished in cubic time.  Each \\(f_i(x)\\) consists of two dot products and a scalar product, which takes linear time, and there are \\(n^2\\) elements in the hessian, so the running time is cubic.


