---
layout: post
title: "Work Log"
description: ""
category: 'Work Log'
tags: []
---
{% include JB/setup %}

Recall  the expression for the i-th element of the gradient of ML w.r.t. indices.

<div>
\[
\begin{align}
g'_i(x) &= \frac{1}{2} z(x)^\top K'(x) z(x) \\
        &= \frac{1}{2} z_i(x) \delta_i^\top(x) z(x) - Z'_i(x) \\
        &= f(x) - Z'_i(x)
\end{align}
\]
</div>

Where \\(\delta_i = k'(x_i, x_j)\\), and \\(Z'_i\\) is the derivitive of the normalization constant.

Next we'll derive the second derivitive starting with the first term, f(x).  We'll use the following identity 

<div>
\[
\begin{align}
\frac{\partial^2 k(x_i, k_j)}{\partial x_i \partial x_j} &= \min(x_i, x_j) \\
\left ( \frac{\partial \delta_i(x)}{\partial x_j} \right)_k &= 
        \begin{cases}
            min(x_i, x_j) & \text{if } k = j \\
            0 & \text{otherwise}
        \end{cases}
\end{align}
\]
</div>




<div>
\[
\begin{align}
\frac{\partial f(x)}{\partial x_j} &=
            \frac{\partial}{\partial x_j} z_i(x) \delta_i^\top(x) z(x)  +
            z_i(x) \frac{\partial}{\partial x_j}\delta_i^\top(x) z(x) +
            z_i(x) \delta_i^\top(x) \frac{\partial}{\partial x_j} z(x) \\
&=
            z_i' (x) \delta_i^\top(x) z(x)  +
            z_i(x) \min(x_i, x_j) z_j(x) + 
            z_i(x) \delta_i^\top(x) z'(x)
\end{align}
\]

where 

\[
\begin{align}
\frac{\partial z(x)}{\partial x_j} &= \frac{\partial}{\partial x_j} S^\top U^{-1}(x) S y \\
        &= S V' S^\top y \\
        &= S^\top U^{-1} U' U^{-1} S y \\
        &= (S^\top U^{-1} S) K' (S^\top U^{-1} S) y
\end{align}
\]
</div>
